---
title: 'Law as Data'
subtitle: "Visualizations"
date: ''
params: 
  date: ''
output: 
  pdf_document:
    toc: true
    latex_engine: xelatex
    includes:
      in_header: preamble.sty
fig_width: 4
fig_height: 2.6
bibliography: bibliography.bib
---

```{r, echo = FALSE, warning = FALSE, message = FALSE, comment = NA, error= FALSE, cache = FALSE}
# Packages
library(tidyverse)
library(knitr)
library(Hmisc)
library(knitr)
library(RColorBrewer)
library(extrafont)
library(kableExtra)
library(sfi)
library(ggplot2)
library(grid)
loadfonts()
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
            cache=FALSE,
              prompt=FALSE,
              tidy=TRUE,
              comment=NA,
              message=FALSE,
              warning=FALSE,
              dpi = 300,
              # dev = "cairo_pdf",
            fig.width = 7.25,
            fig.height = 4,
              dev = c("png", "cairo_pdf"),
              fig.pos="!h",
              fig.path = 'figures/')
opts_knit$set(width=75)
options(xtable.comment = FALSE)
```

```{r}
chunks <- paste0(ifelse(plots_dict$figure == 1,
              paste0('\newpage\n\n\n# ',
      Hmisc::capitalize(plots_dict$author), 
      '\n\n',
      collapse = NULL),
      ''),
      '## Figure ', gsub('_', '.', plots_dict$figure),
      '\n\n```{r ', 
      tolower(plots_dict$author),
      plots_dict$figure,
      '}\n',
      'sfi_plot(author = "',
      plots_dict$author,
      '", figure = "', 
      plots_dict$figure,
      '")\n```\n\n')
chunks <- paste0(chunks, collapse = '')

file_connection <- file('content.Rmd')
writeLines(paste0('---\noutput: pdf_document\n---\n\n', 
                  chunks), 
           file_connection)
close(file_connection)
```


```{r, eval = FALSE}
# Build document from contents of directory
# Get a list of all the child documents
rmds <- list.files(pattern = '*.Rmd', recursive = FALSE, include.dirs = FALSE)
# # Must include an underscore!
# rmds <- rmds[grepl('_', rmds)]

# Should not include the parent doc
rmds <- rmds[rmds != 'all_plots.Rmd']


chunks <- paste0("\n\n```{r child = '", 
                 rmds, 
                 "'}\n```\n")

# Write our order / child-calls to a doc
file_connection <- file('children.Rmd')
writeLines(paste0('---\noutput: pdf_document\n---\n\n', 
                  chunks), 
           file_connection)
close(file_connection)
```

```{r child='content.Rmd', echo = FALSE}
```

```{r, results='hide'}
# file.remove('children.Rmd')
file.remove('content.Rmd')
```

