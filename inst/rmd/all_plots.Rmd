---
title: 'Law as Data'
subtitle: "Visualizations"
date: ''
params: 
  date: ''
output: 
  pdf_document:
    toc: true
    latex_engine: xelatex
    includes:
      in_header: preamble.sty
fig_width: 4
fig_height: 2.6
bibliography: bibliography.bib
---

```{r, echo = FALSE, warning = FALSE, message = FALSE, comment = NA, error= FALSE, cache = FALSE}
# Packages
library(tidyverse)
library(knitr)
library(Hmisc)
library(knitr)
library(RColorBrewer)
library(extrafont)
library(kableExtra)
library(sfi)
library(ggplot2)
library(grid)
loadfonts()
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
            cache=FALSE,
              prompt=FALSE,
              tidy=TRUE,
              comment=NA,
              message=FALSE,
              warning=FALSE,
              dpi = 300,
              # dev = "cairo_pdf",
            fig.width = 7.25,
            fig.height = 4,
              dev = c("png", "cairo_pdf"),
              fig.pos="!h",
              fig.path = 'figures/')
opts_knit$set(width=75)
options(xtable.comment = FALSE)
```


```{r}
plots_dict_plots <- plots_dict %>% filter(!table)
chunks <- paste0(ifelse(plots_dict_plots$figure == '1',
              paste0('\nnewpage\n\n\n## ',
      Hmisc::capitalize(plots_dict_plots$author), 
      '\n\n',
      collapse = NULL),
      ''),
      '### Figure ', gsub('_', '.', plots_dict_plots$figure),
      '\n\n```{r ', 
      tolower(plots_dict_plots$author),
      plots_dict_plots$figure,
      '}\n',
      'sfi_plot_unlist(sfi_plot(author = "',
      plots_dict_plots$author,
      '", figure = "', 
      plots_dict_plots$figure,
      '"))\n```\n\n')
chunks <- paste0(chunks, collapse = '')

chunks <- paste0('# Plots\n\n', chunks, collapse = '')

file_connection <- file('plots.Rmd')
writeLines(paste0('---\noutput: pdf_document\n---\n\n', 
                  chunks), 
           file_connection)
close(file_connection)
```



```{r}
plots_dict_tables <- plots_dict %>% filter(table)
plots_dict_tables <- plots_dict_tables %>%
  group_by(author) %>%
  mutate(figure_first = dplyr::first(figure) == figure) %>%
  ungroup
chunks <- paste0(ifelse(plots_dict_tables$figure_first,
              paste0('\nnewpage\n\n\n## ',
      Hmisc::capitalize(plots_dict_tables$author), 
      '\n\n',
      collapse = NULL),
      ''),
      '### Table ', gsub('_', '.', plots_dict_tables$figure),
      '\n\n```{r ', 
      tolower(plots_dict_tables$author),
      plots_dict_tables$figure,
      ',  results = "asis"}\n',
      'sfi_plot_unlist(sfi_plot(author = "',
      plots_dict_tables$author,
      '", figure = "', 
      plots_dict_tables$figure,
      '"))\n```\n\n')
chunks <- paste0(chunks, collapse = '')


chunks <- paste0('# Tables\n\n', chunks, collapse = '')

file_connection <- file('tables.Rmd')
writeLines(paste0('---\noutput: pdf_document\n---\n\n', 
                  chunks), 
           file_connection)
close(file_connection)
```

```{r child='plots.Rmd', echo = FALSE}
```

```{r child='tables.Rmd', echo = FALSE}
```

```{r, results='hide'}
file.remove('plots.Rmd')
file.remove('tables.Rmd')
```

